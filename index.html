<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Travel Map with Sidebar Notes</title>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet/dist/leaflet.css"
/>
<style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  #map {
    position: absolute;
    top: 0; bottom: 0; left: 0;
    right: 300px; /* leave room for sidebar */
  }
  #notes {
    position: absolute;
    top: 0; bottom: 0; right: 0;
    width: 300px;
    overflow-y: auto;
    padding: 15px;
    box-sizing: border-box;
    border-left: 1px solid #ccc;
    background: #f9f9f9;
    font-family: Arial, sans-serif;
  }
  #notes h2 {
    margin-top: 0;
  }
</style>
</head>
<body>

<div id="map"></div>
<div id="notes">
  <h2>Itinerary / Notes</h2>
  <div id="notesContent">Click a marker to see details here.</div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
  const MAP = L.map("map").setView([20, 0], 2);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap contributors",
  }).addTo(MAP);

  const colorPalette = [
    "#e6194b", "#3cb44b", "#ffe119", "#4363d8", "#f58231",
    "#911eb4", "#46f0f0", "#f032e6", "#bcf60c", "#fabebe",
    "#008080", "#e6beff", "#9a6324", "#fffac8", "#800000",
    "#aaffc3", "#808000", "#ffd8b1", "#000075", "#808080"
  ];

  const nameColors = {};
  let colorIndex = 0;

  function getColorForName(name) {
    if (!nameColors[name]) {
      nameColors[name] = colorPalette[colorIndex % colorPalette.length];
      colorIndex++;
    }
    return nameColors[name];
  }

  function createColoredSvgMarker(color) {
    const svg = `
      <svg width="30" height="42" viewBox="0 0 30 42" xmlns="http://www.w3.org/2000/svg">
        <path fill="${color}" stroke="black" stroke-width="2" d="M15 1 C22 1 28 7 28 14 C28 26 15 41 15 41 C15 41 2 26 2 14 C2 7 8 1 15 1 Z"/>
      </svg>
    `;
    return L.divIcon({
      className: "",
      html: svg,
      iconSize: [30, 42],
      iconAnchor: [15, 41],
    });
  }

  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTEmF0OSAMFJjQZLt-ZdWGD0sYucQn7qMHnzt4H-QS_mF37LYRNbpsKI4xXPBfihdcIRs5SOoXVqGGz/pub?gid=0&single=true&output=csv";

  function fetchAndDisplay() {
    Papa.parse(CSV_URL, {
      download: true,
      header: true,
      complete: function (results) {
        for (const row of results.data) {
          const { Name, Location, Date, "Itinerary/Notes": Notes, Latitude, Longitude } = row;
          const lat = parseFloat(Latitude);
          const lon = parseFloat(Longitude);
          if (!isNaN(lat) && !isNaN(lon)) {
            const color = getColorForName(Name);
            const icon = createColoredSvgMarker(color);
            const marker = L.marker([lat, lon], { icon: icon }).addTo(MAP);
            marker.bindPopup(`<strong>${Name}</strong><br>${Location}<br>${Date}`);
            marker.on('click', () => {
              document.getElementById('notesContent').innerHTML = Notes || "<em>No notes provided.</em>";
            });
          }
        }
      },
    });
  }

  fetchAndDisplay();
</script>

</body>
</html>
